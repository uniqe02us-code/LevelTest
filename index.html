<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Ø¢Ø²Ù…ÙˆÙ† Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ</title>
  <meta name="color-scheme" content="light dark" />
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" />

  <!-- ====== Ø§Ø³ØªØ§ÛŒÙ„ Ø§Ø±Ø³Ø§Ù„ÛŒ Ø´Ù…Ø§ (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±) + Ú†Ù†Ø¯ Ø®Ø· Ú©ÙˆÚ†Ú© Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ø³Ø®â€ŒÙ†Ø§Ù…Ù‡ ====== -->
  <style>
    :root {
      /* ØªÙ… Ù¾ÛŒØ´â€ŒÙØ±Ø¶: Ø±ÙˆØ´Ù† */
      --bg-gradient: linear-gradient(135deg, #e0f7fa 0%, #f3e5f5 100%);
      --screen-bg: white;
      --text-primary: #2c3a47;
      --text-secondary: #555;
      --btn-gradient-start: #6a5acd;
      --btn-gradient-end: #8a7bf0;
      --option-bg: #f8f9ff;
      --option-hover: #edf2ff;
      --selected-bg: #f0f4ff;
      --border-color: rgba(106, 90, 205, 0.2);
      --shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
      --particles-color-1: rgba(138, 43, 226, 0.03);
      --particles-color-2: rgba(74, 108, 247, 0.03);
    }

    .dark-theme {
      --bg-gradient: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      --screen-bg: rgba(20, 18, 35, 0.85);
      --text-primary: #ffffff;
      --text-secondary: #c5c6d0;
      --btn-gradient-start: #6a5acd;
      --btn-gradient-end: #8a7bf0;
      --option-bg: rgba(30, 28, 50, 0.7);
      --option-hover: rgba(40, 35, 70, 0.8);
      --selected-bg: rgba(40, 35, 70, 0.8);
      --border-color: rgba(106, 90, 205, 0.2);
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      --particles-color-1: rgba(138, 43, 226, 0.15);
      --particles-color-2: rgba(74, 108, 247, 0.15);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Vazirmatn', 'Segoe UI', sans-serif;
      background: var(--bg-gradient);
      min-height: 100vh;
      display: flex; justify-content: center; align-items: center;
      padding: 20px; color: var(--text-primary);
      overflow: hidden; position: relative;
      transition: background 0.5s ease;
    }

    body::before {
      content: "";
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background:
        radial-gradient(circle at 20% 30%, var(--particles-color-1) 2px, transparent 3px),
        radial-gradient(circle at 80% 70%, var(--particles-color-2) 2px, transparent 3px);
      animation: float 25s infinite linear; pointer-events: none; z-index: 0;
    }
    @keyframes float { 0% {transform:translate(0,0)} 100% {transform:translate(-20px,-20px)} }

    .theme-toggle {
      position: absolute; top: 20px; right: 20px;
      background: var(--screen-bg); border: 1px solid var(--border-color);
      width: 44px; height: 44px; border-radius: 50%;
      display: flex; justify-content: center; align-items: center;
      cursor: pointer; z-index: 100; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: all 0.3s ease; color: var(--text-primary);
    }
    .theme-toggle:hover { transform: rotate(20deg); }

    .screen {
      width: 100%; max-width: 650px; background: var(--screen-bg);
      padding: 50px 30px; border-radius: 28px; box-shadow: var(--shadow);
      text-align: center; position: relative; z-index: 10;
      opacity: 0; transform: translateY(20px);
      transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
      display: none; backdrop-filter: blur(10px);
      border: 1px solid var(--border-color);
    }
    .screen.active { display: block; opacity: 1; transform: translateY(0); }

    .welcome-icon {
      font-size: 60px; margin: 20px 0; color: var(--btn-gradient-start);
      animation: breathe 4s infinite ease-in-out;
    }
    @keyframes breathe { 0%,100%{transform:scale(1)} 50%{transform:scale(1.08)} }

    h1 { font-size: 28px; margin: 15px 0; color: var(--text-primary); }
    p  { font-size: 17px; line-height: 1.7; margin: 20px auto; color: var(--text-secondary); max-width: 550px; }

    .btn {
      background: linear-gradient(to right, var(--btn-gradient-start), var(--btn-gradient-end));
      color: white; border: none; padding: 15px 45px; font-size: 18px; font-weight: 600;
      border-radius: 50px; cursor: pointer; box-shadow: 0 6px 20px rgba(106, 90, 205, 0.4);
      transition: all 0.3s ease; margin-top: 10px; position: relative; overflow: hidden;
    }
    .btn::after {
      content: ''; position: absolute; top: 0; left: -100%;
      width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.25), transparent);
      transition: 0.6s;
    }
    .btn:hover::after { left: 100%; }
    .btn:hover { transform: translateY(-4px); box-shadow: 0 10px 25px rgba(106, 90, 205, 0.5); }
    .btn[disabled]{filter:grayscale(.35) brightness(.9); cursor:not-allowed}

    .progress { font-size: 15px; color: var(--text-secondary); margin-bottom: 20px; }

    .options { display: flex; flex-direction: column; gap: 16px; margin: 25px 0; }
    .option {
      background: var(--option-bg); padding: 18px; border-radius: 18px;
      cursor: pointer; text-align: right; transition: all 0.3s ease;
      border: 2px solid transparent; position: relative; overflow: hidden;
      color: var(--text-primary); font-weight: 600;
    }
    .option::before {
      content: ''; position: absolute; top: 0; right: 0; width: 0; height: 100%;
      background: rgba(106, 90, 205, 0.12); transition: width 0.4s ease; z-index: 0;
    }
    .option:hover::before { width: 100%; }
    .option.selected { border-color: var(--btn-gradient-start); background: var(--selected-bg); transform: translateX(5px); }

    .result-icon { font-size: 70px; margin: 20px 0; color: #48bb78; animation: twinkle 2.5s infinite alternate; }
    @keyframes twinkle { 0%{transform:scale(1);opacity:1} 100%{transform:scale(1.15);opacity:.7} }

    .level-badge {
      display:inline-block; background: linear-gradient(to right, #4a5568, var(--btn-gradient-start));
      color:#fff; padding:8px 24px; border-radius:30px; font-weight:bold; margin-top:20px; font-size:19px;
      opacity:0; transform:scale(.8); animation: popIn .7s .3s cubic-bezier(.18,.89,.32,1.28) forwards;
    }
    @keyframes popIn { to{opacity:1; transform:scale(1)} }

    .fade-in-right { animation: fadeInRight .6s ease forwards; opacity:0; }
    @keyframes fadeInRight { from{opacity:0; transform:translateX(30px)} to{opacity:1; transform:translateX(0)} }

    .stats { margin-top: 20px; font-size: 15px; color: var(--text-secondary); }

    @media (max-width: 600px) {
      .screen { padding: 35px 20px; }
      h1 { font-size: 24px; }
      p  { font-size: 16px; }
    }

    /* â€”â€”â€” Ù¾Ø§Ø³Ø®â€ŒÙ†Ø§Ù…Ù‡ Ø®ÙˆØ§Ù†Ø§ Ø¯Ø± Ù‡Ø± Ø¯Ùˆ ØªÙ… â€”â€”â€” */
    dialog.modal{ width:min(96vw,980px); background:var(--screen-bg); color:var(--text-primary);
      border:1px solid var(--border-color); border-radius:18px; box-shadow:var(--shadow); padding:0 }
    dialog.modal::backdrop{ background:rgba(0,0,0,.55); backdrop-filter:blur(6px) }
    .modal header{ display:flex; justify-content:space-between; align-items:center; gap:8px;
      padding:12px 14px; border-bottom:1px solid var(--border-color) }
    .modal .body{ max-height:78svh; overflow:auto; padding:12px 14px }
    .ak-item{ background:var(--option-bg); border:1px solid var(--border-color); border-radius:14px; padding:10px; margin:8px 0; text-align:right }
    .ak-q{ font-weight:900; margin-bottom:6px; color:var(--text-primary) }
    .chip-ans{ display:inline-block; padding:6px 10px; border-radius:999px; margin-inline-start:6px; border:1px solid var(--border-color); line-height:1.75 }
    .chip-ans.ok{  background:rgba(16,185,129,.16); color:#065f46 }
    .chip-ans.err{ background:rgba(239,68,68,.16);  color:#7f1d1d }
    .dark-theme .chip-ans.ok{  color:#dcfce7; border-color:rgba(16,185,129,.55) }
    .dark-theme .chip-ans.err{ color:#fee2e2; border-color:rgba(239,68,68,.55) }
  </style>

  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
</head>
<body>
  <!-- Ø¢ÛŒÚ©ÙˆÙ† ØªØºÛŒÛŒØ± ØªÙ… Ø¯Ø± Ú¯ÙˆØ´Ù‡Ù” Ø±Ø§Ø³Øª Ø¨Ø§Ù„Ø§ -->
  <button id="themeToggle" class="theme-toggle" aria-label="ØªØºÛŒÛŒØ± ØªÙ…" title="ØªØºÛŒÛŒØ± ØªÙ…">ğŸŒ</button>

  <main>
    <!-- Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯ -->
    <section id="welcome" class="screen active">
      <div class="welcome-icon">ğŸ“š</div>
      <h1>Ø¨Ù‡ Ø¢Ø²Ù…ÙˆÙ† Ø²Ø¨Ø§Ù† Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!</h1>
      <p>Ø¯Ø± Ø§ÛŒÙ† ÙØ¶Ø§ÛŒ Ø¢Ø±Ø§Ù…ØŒ Ø³Ø·Ø­ Ø²Ø¨Ø§Ù† Ø®ÙˆØ¯ Ø±Ø§ Ú©Ø´Ù Ú©Ù†ÛŒØ¯. Û±Û° Ø³Ø¤Ø§Ù„ Ù‡ÙˆØ´Ù…Ù†Ø¯Ø§Ù†Ù‡ â€” Ø¨Ø¯ÙˆÙ† Ø§Ø³ØªØ±Ø³ØŒ Ø¨Ø§ Ù„Ø°Øª.</p>
      <p id="statsWelcome" style="margin-top:6px">Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¢Ù…Ø§Ø±â€¦</p>
      <div style="margin-top:14px"><button class="btn" id="startBtn">ğŸŒ¸ Ø´Ø±ÙˆØ¹ Ø¢Ø²Ù…ÙˆÙ†</button></div>
    </section>

    <!-- Ø¢Ø²Ù…ÙˆÙ† -->
    <section id="quiz" class="screen" aria-live="polite">
      <div class="progress">Ø³Ø¤Ø§Ù„ <span id="current">1</span> / 10</div>
      <h2 id="question-text" style="text-align:right; font-weight:900">&nbsp;</h2>
      <div id="options" class="options" role="radiogroup" aria-label="Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§"></div>
      <div style="margin-top:10px; display:flex; justify-content:flex-end">
        <button class="btn" id="nextBtn" disabled>Ø¨Ø¹Ø¯ÛŒ â</button>
      </div>
    </section>

    <!-- Ù†ØªÛŒØ¬Ù‡ -->
    <section id="result" class="screen">
      <div class="result-icon" aria-hidden="true">âœ¨</div>
      <h1>Ø¢Ø²Ù…ÙˆÙ† Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯!</h1>
      <p id="result-text">â€¦</p>
      <div id="level-display" aria-live="polite"></div>
      <p id="stats" class="stats">Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¢Ù…Ø§Ø±â€¦</p>
      <div style="margin-top:12px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
        <button id="answerKeyBtn" class="btn">ğŸ“„ Ù¾Ø§Ø³Ø®â€ŒÙ†Ø§Ù…Ù‡</button>
        <button id="restartBtn" class="btn">ğŸ” Ø¢Ø²Ù…ÙˆÙ† Ø¯ÙˆØ¨Ø§Ø±Ù‡</button>
      </div>
    </section>
  </main>

  <!-- Ù¾Ø§Ø³Ø®â€ŒÙ†Ø§Ù…Ù‡ -->
  <dialog id="akDialog" class="modal" aria-labelledby="akTitle">
    <header>
      <h3 id="akTitle" style="font-weight:900">Ù¾Ø§Ø³Ø®â€ŒÙ†Ø§Ù…Ù‡ Ø¢Ø²Ù…ÙˆÙ†</h3>
      <button id="akClose" class="btn" style="--btn-gradient-start:#334155;--btn-gradient-end:#475569">Ø¨Ø³ØªÙ†</button>
    </header>
    <div class="body"><div id="akItems"></div></div>
  </dialog>

  <script>
    /* ==== Ø³ÙˆÛŒÛŒÚ†Ø± ØªÙ… (ÙÙ‚Ø· Ø¸Ø§Ù‡Ø±) ==== */
    const themeToggle = document.getElementById('themeToggle');
    function applyTheme() {
      const saved = localStorage.getItem('theme') || 'light';
      document.body.classList.toggle('dark-theme', saved === 'dark');
      themeToggle.textContent = saved === 'dark' ? 'ğŸŒ™' : 'ğŸŒ';
    }
    applyTheme();
    themeToggle.addEventListener('click', () => {
      const toDark = !document.body.classList.contains('dark-theme');
      document.body.classList.toggle('dark-theme', toDark);
      localStorage.setItem('theme', toDark ? 'dark' : 'light');
      themeToggle.textContent = toDark ? 'ğŸŒ™' : 'ğŸŒ';
    }, {passive:true});

    /* ==== Firebase: Ù…Ù†Ø·Ù‚ Ù‚Ø¨Ù„ÛŒ Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ù…Ø¤Ø«Ø± ==== */
    const cfg={apiKey:"AIzaSyBcRxeCvCKQ9IJdjfh7V6NNNkymyAtMwp0",authDomain:"fashenglishtest.firebaseapp.com",databaseURL:"https://fashenglishtest-default-rtdb.firebaseio.com",projectId:"fashenglishtest",storageBucket:"fashenglishtest.firebasestorage.app",messagingSenderId:"142726893273",appId:"1:142726893273:web:e8cb4f4982b20065d2f8c8"};
    let ready=false;
    try{
      if(!firebase.apps.length) firebase.initializeApp(cfg);
      firebase.auth().onAuthStateChanged(u=>{ ready=!!u; if(!u) firebase.auth().signInAnonymously().catch(()=>{}); });
      const cref=firebase.database().ref('counter');
      cref.on('value',s=>{
        const n=s.val()||0;
        const w=document.getElementById('statsWelcome');
        if(w) w.textContent='ØªØ§ Ú©Ù†ÙˆÙ† '+n+' Ù†ÙØ± Ø§Ø² Ø§ÛŒÙ† Ø¢Ø²Ù…ÙˆÙ† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ø±Ø¯Ù‡â€ŒØ§Ù†Ø¯! ğŸ‰';
        if(document.getElementById('result').classList.contains('active'))
          document.getElementById('stats').textContent='ğŸ‰ ØªØ§Ú©Ù†ÙˆÙ† '+n+' Ù†ÙØ± Ø§Ø² Ø§ÛŒÙ† Ø¢Ø²Ù…ÙˆÙ† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ø±Ø¯Ù‡â€ŒØ§Ù†Ø¯!';
      });
    }catch(e){}

    /* ==== Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ùˆ Ù…Ù†Ø·Ù‚ Ø¢Ø²Ù…ÙˆÙ† (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±) ==== */
    const Q=[{t:"?What is the opposite of 'happy'",o:["Angry","Sad","Tired","Busy"],c:1},{t:":Choose the correct sentence",o:[".She go to school",".She goes to school",".She going to school",".She gone to school"],c:1},{t:"?What does 'delicious' mean",o:["Boring","Expensive","Tasty","Cold"],c:2},{t:".If I _____ you, I would study harder",o:["am","was","were","be"],c:2},{t:"?Which sentence is in the past perfect tense",o:[".I have eaten",".I ate",".I had eaten",".I will have eaten"],c:2},{t:"'.He has been working here _____ 2015'",o:["for","since","from","in"],c:1},{t:"?What is a synonym for 'exhausted'",o:["Excited","Very tired","Happy","Angry"],c:1},{t:":Choose the correct passive sentence",o:[".The book wrote by her",".The book was written by her",".The book is wrote by her",".She was written the book"],c:1},{t:"'.Despite _____ tired, she finished her homework'",o:["of being","being","she was","to be"],c:1},{t:"?What does 'ambiguous' mean",o:["Very clear","Unclear or having more than one meaning","Angry","Expensive"],c:1}];

    const sW=document.getElementById('welcome'),sQ=document.getElementById('quiz'),sR=document.getElementById('result');
    const start=document.getElementById('startBtn'),next=document.getElementById('nextBtn'),restart=document.getElementById('restartBtn'),qTxt=document.getElementById('question-text'),opts=document.getElementById('options'),cur=document.getElementById('current');
    const akBtn=document.getElementById('answerKeyBtn'),dlg=document.getElementById('akDialog'),akClose=document.getElementById('akClose'),akItems=document.getElementById('akItems');
    let idx=0,ans=new Array(Q.length).fill(null),finished=false;

    function show(el){[sW,sQ,sR].forEach(x=>x.classList.remove('active'));el.classList.add('active');scrollTo({top:0,behavior:'smooth'})}
    function renderOptions(){
      opts.innerHTML='';
      const q=Q[idx];
      q.o.forEach((label,i)=>{
        const b=document.createElement('button');
        b.type='button'; b.className='option'; b.role='radio'; b.setAttribute('aria-checked',ans[idx]===i?'true':'false');
        b.tabIndex=0; b.textContent=label; b.dataset.i=i;
        b.addEventListener('click',()=>select(i));
        b.addEventListener('keydown',ev=>{
          if(ev.key==='ArrowUp'||ev.key==='ArrowRight'){ev.preventDefault();move(1)}
          else if(ev.key==='ArrowDown'||ev.key==='ArrowLeft'){ev.preventDefault();move(-1)}
          else if(ev.key===' '||ev.key==='Enter'){ev.preventDefault();select(i)}
        });
        opts.appendChild(b);
      });
      updateSel();
      function move(d){let s=ans[idx]??0; s=(s+d+Q[idx].o.length)%Q[idx].o.length; select(s,true)}
    }
    function load(){const q=Q[idx]; qTxt.textContent=q.t; cur.textContent=idx+1; renderOptions()}
    function updateSel(){const s=ans[idx]; opts.querySelectorAll('.option').forEach(b=>{const on=Number(b.dataset.i)===s; b.classList.toggle('selected',on); b.setAttribute('aria-checked',on?'true':'false')}); next.disabled=(s==null)}
    function select(i){ans[idx]=i; updateSel()}

    start.addEventListener('click',()=>{idx=0; ans.fill(null); finished=false; show(sQ); load()});
    next.addEventListener('click',()=>{ if(idx<Q.length-1){ idx++; load() } else { finish() }});
    restart.addEventListener('click',()=>{ show(sW) });

    function level(sc){return sc<=3?'A1 (Ù…Ø¨ØªØ¯ÛŒ)':sc<=5?'A2 (Ù¾Ø§ÛŒÙ‡)':sc<=7?'B1 (Ù…ØªÙˆØ³Ø·)':sc<=9?'B2 (Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø² Ù…ØªÙˆØ³Ø·)':'C1 (Ù¾ÛŒØ´Ø±ÙØªÙ‡)'}
    function buildAK(){
      akItems.innerHTML='';
      for(let i=0;i<Q.length;i++){
        const q=Q[i],ua=ans[i],uaT=(ua==null?'Ø¨ÛŒâ€ŒÙ¾Ø§Ø³Ø®':q.o[ua]),ok=(ua===q.c),caT=q.o[q.c];
        const div=document.createElement('div');
        div.className='ak-item';
        div.innerHTML=`<div class="ak-q">${i+1}. ${q.t}</div>
          <span class="chip-ans ${ok?'ok':'err'}">${ok?'âœ… Ù¾Ø§Ø³Ø® Ø´Ù…Ø§:':'âŒ Ù¾Ø§Ø³Ø® Ø´Ù…Ø§:'} ${uaT}</span>
          <span class="chip-ans ok">âœ” Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­: ${caT}</span>`;
        akItems.appendChild(div);
      }
    }
    akBtn.addEventListener('click',()=>{ buildAK(); if(!dlg.open) dlg.showModal() });
    akClose.addEventListener('click',()=>dlg.close());
    dlg.addEventListener('click',e=>{ if(e.target===dlg) dlg.close() });

    async function finish(){
      if(finished) return; finished=true;
      let s=0; for(let i=0;i<Q.length;i++) if(ans[i]===Q[i].c) s++;
      document.getElementById('result-text').innerHTML='Ø§Ù…ØªÛŒØ§Ø² Ø´Ù…Ø§: <b>'+s+'</b> Ø§Ø² 10';
      document.getElementById('level-display').innerHTML='<span class="level-badge">'+level(s)+'</span>';
      show(sR);
      try{
        const t0=Date.now();
        while(!ready && (Date.now()-t0)<4000) await new Promise(r=>setTimeout(r,150));
        if(ready) await firebase.database().ref('counter').transaction(c=>(c||0)+1);
      }catch(_){}
    }
  </script>
</body>
</html>
